<!-- To-Do App -->
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ToDo List</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
        crossorigin="anonymous">
    <style type="text/css">
        :root {
            --bs-dark: #492E87;
            --bs-light: #FFD0EC;
            --bs-primary: #474F7A;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html,
        body {
            height: 100%;
            font-family: sans-serif;
            background-color: var(--bs-dark);
            color: var(--bs-primary);
        }

        .wrapper {
            min-height: 100%;
            display: flex;
            flex-direction: column;
        }

        h1,h2 {
            color: var(--bs-dark);
        }

        #form-container {
            margin-top: 3px;
            background-color: var(--bs-light);
            border: 2px solid var(--bs-dark);
        }

        label {
            font-weight: bold;
        }

        .form-control {
            border: 1px solid var(--bs-dark);
        }

        .list-group-item {
            position: relative;
            padding: 1rem 1.25rem;
            margin-bottom: -1px;
            background-color: var(--bs-primary);
            border: 1px solid var(--bs-dark);
            color: var(--bs-light);
            font-size: medium;
            font-weight: bold;
            border-bottom: 2px solid var(--bs-dark);
            word-break: break-all;
        }
    
        #list-container{
            background-color: var(--bs-light);
            border: 2px solid var(--bs-dark);
        }

        .btn{
            border: 1px solid var(--bs-dark);
        }

        .btn-primary, .btn-secondary{
            background-color: var(--bs-primary);
            border: 1px solid var(--bs-dark);
        }

    </style>
</head>

<body>
    <div class="wrapper">
        <div id="form-container" class="container py-4">
            <h1 class="text-center mb-4 p-1">
                <svg xmlns="http://www.w3.org/2000/svg" width="112" height="112" fill="currentColor" class="bi bi-clipboard2-check-fill" viewBox="0 0 16 16">
                    <path d="M10 .5a.5.5 0 0 0-.5-.5h-3a.5.5 0 0 0-.5.5.5.5 0 0 1-.5.5.5.5 0 0 0-.5.5V2a.5.5 0 0 0 .5.5h5A.5.5 0 0 0 11 2v-.5a.5.5 0 0 0-.5-.5.5.5 0 0 1-.5-.5"/>
                    <path d="M4.085 1H3.5A1.5 1.5 0 0 0 2 2.5v12A1.5 1.5 0 0 0 3.5 16h9a1.5 1.5 0 0 0 1.5-1.5v-12A1.5 1.5 0 0 0 12.5 1h-.585q.084.236.085.5V2a1.5 1.5 0 0 1-1.5 1.5h-5A1.5 1.5 0 0 1 4 2v-.5q.001-.264.085-.5m6.769 6.854-3 3a.5.5 0 0 1-.708 0l-1.5-1.5a.5.5 0 1 1 .708-.708L7.5 9.793l2.646-2.647a.5.5 0 0 1 .708.708"/>
                </svg>
                <br>
                Must Do's
            </h2>
            <form id="todo-form" class="form mb-3 p-3">
                <div class="row py-2">
                    <div class="col-10">
                        <label for="todo-input" class="form-label">ToDo Note</label>
                        <input type="text" class="form-control" id="todo-input" placeholder="Enter a new ToDo">
                    </div>
                    <div class="col-2">
                        <label for="due-date-input" class="form-label">Due Date (Optional)</label>
                        <input type="date" class="form-control" id="due-date-input">
                    </div>
                </div>
                <div class="row">
                    <div class="col">
                        <button type="submit" class="btn btn-primary p-2">Add ToDo</button>
                    </div>
                </div>
            </form>
            <form id="search-form" class="form-inline mb-3 p-3">
                <div class="row">
                    <div class="col-10">
                        <input id="searchInput" class="form-control" type="search" placeholder="Enter text to search"
                            aria-label="Search">
                    </div>
                    <div class="col-2">
                        <button class="btn btn-secondary my-2 my-sm-0" type="submit">Search</button>
                    </div>
                </div>
            </form>
        </div>
        <div id="list-container" class="container py-4">
            <h2 class="text-center mb-4 p-3">ToDo List</h2>
            <ul id="todo-list" class="list-group mt-3">
            </ul>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"
        crossorigin="anonymous"></script>
    <script type="text/javascript">
        const todoForm = document.getElementById('todo-form');
        const todoInput = document.getElementById('todo-input');
        const todoList = document.getElementById('todo-list');
        const searchForm = document.getElementById('search-form');
        const searchInput = document.getElementById('searchInput');

        // Create
        todoForm.addEventListener('submit', function (e) {
            e.preventDefault();
            if (todoInput.value) {
                //Add todo 
                const li = document.createElement('li');
                li.className = 'list-group-item d-flex justify-content-between align-items-center';
                const textDiv = document.createElement('div');
                textDiv.className = 'todo-text float-start';
                textDiv.appendChild(document.createTextNode(todoInput.value));
                li.appendChild(textDiv);

                const controlContainer = document.createElement('div');
                controlContainer.className = 'd-flex align-items-center';

                // Add due date if one is provided
                const dueDateInput = document.getElementById('due-date-input');
                const dueDateValue = dueDateInput.value || 'No Due Date';
                if (dueDateValue !== 'No Due Date') {
                    const dueDate = document.createElement('span');
                    dueDate.className = 'due-date mr-3 px-2';
                    dueDate.appendChild(document.createTextNode(' Due: ' + dueDateInput.value));
                    controlContainer.appendChild(dueDate);
                }

                const buttonDiv = document.createElement('div');
                buttonDiv.className = 'btn-group btn-group-sm';
                buttonDiv.setAttribute('role', 'group');

                // Add edit button
                const editButton = document.createElement('button');
                editButton.type = 'button';
                editButton.className = 'btn btn-success btn-sm edit';
                editButton.appendChild(document.createTextNode('Edit'));
                buttonDiv.appendChild(editButton);

                // Add priority button
                const priorityButton = document.createElement('button');
                priorityButton.type = 'button';
                priorityButton.className = 'btn btn-warning btn-sm priority';
                priorityButton.appendChild(document.createTextNode('Priority: Medium'));
                buttonDiv.appendChild(priorityButton);

                // Add delete button
                const deleteButton = document.createElement('button');
                deleteButton.type = 'button';
                deleteButton.className = 'btn btn-danger btn-sm delete';
                deleteButton.appendChild(document.createTextNode('X'));
                buttonDiv.appendChild(deleteButton);

                // Add todo item to list
                controlContainer.appendChild(buttonDiv);             
                li.appendChild(controlContainer);
                todoList.appendChild(li);
                console.log("Added New To-Do");

                todoInput.value = '';
                dueDateInput.value = '';
            }
            sortTodoItems();
        });

        // Delete
        todoList.addEventListener('click', function (e) {
            if (e.target.classList.contains('delete')) {
                if (confirm('Are you sure?')) {
                    const li = e.target.closest('li');
                    todoList.removeChild(li);
                    console.log("Deleted To-Do");
                }
            }
        });

        // Update
        todoList.addEventListener('click', function (e) {
            if (e.target.classList.contains('edit')) {
                const li = e.target.closest('li');
                const oldTodo = li.querySelector('.todo-text').textContent;
                const newTodo = prompt('Enter new todo', oldTodo);
                if (newTodo) {
                    li.querySelector('.todo-text').textContent = newTodo;
                }   
                console.log("Updated To-Do");
            }
        });

        // Modify Priority
        todoList.addEventListener('click', function (e) {
            if (e.target.classList.contains('priority')) {
                const currentPriority = e.target.textContent.split(': ')[1];
                const li = e.target.closest('li')
                let newPriority;
                switch (currentPriority) {
                    case 'High':
                        newPriority = 'Low';
                        li.style.backgroundColor = '#477A4F';
                        break;
                    case 'Medium':
                        newPriority = 'High';
                        li.style.backgroundColor = '#7A474F';
                        break;
                    case 'Low':
                        newPriority = 'Medium';
                        li.style.backgroundColor = ' var(--bs-primary)';
                        break;
                }
                e.target.textContent = 'Priority: ' + newPriority;
                sortTodoItems();
                console.log("Modified To-Do Priority");
            }
        });

        // Search
        searchForm.addEventListener('submit', function (e) {
            e.preventDefault();

            const searchQuery = searchInput.value.toLowerCase();
            const todoItems = document.querySelectorAll('.list-group-item');

            todoItems.forEach(function (todoItem) {
                const itemText = todoItem.firstChild.textContent.toLowerCase();
                if (itemText.indexOf(searchQuery) != -1) {
                    todoItem.style.display = 'block';
                } else {
                    todoItem.style.display = 'none';
                }
            });
            console.log("Searched for" + searchQuery);        
        });


        // Function to get priority from a todo item
        function getPriority(todoItem) {
            const priorityButton = todoItem.querySelector('.priority');
            const priority = priorityButton.textContent.split(': ')[1];
            switch (priority) {
                case 'High':
                    return 3;
                case 'Medium':
                    return 2;
                case 'Low':
                    return 1;
                default:
                    return 0;
            }
        }

        // Function to sort todo items by priority
        function sortTodoItems() {
            const todoItems = Array.from(todoList.children);
            todoItems.sort(function (a, b) {
                return getPriority(b) - getPriority(a);
            });
            todoItems.forEach(function (todoItem) {
                todoList.appendChild(todoItem);
            });
        }

        
    </script>
</body>
</html>